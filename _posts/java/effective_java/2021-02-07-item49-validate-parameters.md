---
title: "[Effective Java] Item 49. 매개변수가 유효한지 검사하라"
excerpt: "메서드나 생성자를 작성할 때면 그 매개변수들에 어떤 제약이 있을지 생각해야 한다."
categories:
  - Java
tags:
  - Java
  - Effective Java
date: 2021-02-07
last_modified_at: 2021-02-07
---

## 1. 매개변수 유효성 검사

입력 매개변수의 값에 대한 제약은 반드시 문서화해야 한다.

* public이나 protected 메서드는 매개변수 값이 잘못됐을 때 던지는 예외를 @throws 태그로 문서화한다.
* @Nullable 등의 애너테이션을 통해 특정 매개변수에 대한 제약을 알릴 수 있으나 표준적인 방법은 아니다.

매개변수 오류는 메서드 몸체가 시작되기 전에 검사해야 한다.

* 오류는 가능한 한 빨리 발생한 곳에서 잡아야 한다.
  * 즉시 잡지 못하면 해당 오류를 감지하거나 오류 발생 지점을 찾기 어려워진다.
* 매개변수 검사를 제대로 하지 않으면 실패 원자성을 어기는 결과를 낳는다.
  * 에러가 있음에도 메서드가 문제없이 수행되었지만, 어떤 객체를 이상한 상태로 만들거나 잘못된 결과를 반환한다.
  * 미래의 알 수 없는 시점에 메서드와는 관련 없는 오류를 내어 디버깅하기 어려워진다

### 1.1. 검사 예시

> Strategy.java

```java
this.strategy = Objects.requireNonNull(strategy, "전략");
```

* Objects가 제공하는 메서드를 사용하여 NPE를 검사한다.

> AssertionTest.java

```java
private static void sort(long a[], int offset, int length) {
    assert a != null;
    assert offeset >= 0 && offset <= a.length;
}
```

* 공개되지 않은 private 메서드라면 메서드 호출 상황을 통제할 수 있기 때문에 단언문을 사용할 수 있다.
* 실패하면 AssertionError를 던지지만, 런타임에 아무런 효과나 성능 저하가 없다.
  * 단, 개별 플래그를 설정하면 런타임에 영향을 준다.

<br>

## 2. 유효성 검사 규칙의 예외

메서드 몸체 실행 전에 매개변수 유효성을 검사해야 한다는 규칙에도 예외가 있다.

* 유효성 검사 비용이 너무 높거나 실용적이지 않을 때, 혹은 계산 과정에서 암묵적으로 검사가 수행될 때다.
  * 컬렉션의 정렬 메서드는 리스트 안의 객체들이 모두 상호 비교 될 수 있어야 한다.
  * 정렬 과정에서 이 비교가 이루어지며, 비교될 수 없는 경우 예외가 발생한다.
  * 비교하기 전에 리스트의 객체들이 모두 상호 비교될 수 있는지 검사해도 실익이 없다.
* 단, 암묵적 유효성 검사에 너무 의존했다가 실패 원자성을 해칠 수 있다.

계산 과정에서 필요한 유효성 검사가 이뤄지지만, 실패했을 때 잘못된 예외를 던지기도 한다. 즉, API 문서에 던지기로 한 예외가 실제 발생한 예외가 다를 수 있다.

* 예외 번역 관용구를 사용하여 API 문서에 기재된 예외로 번역해줘야 한다.

<br>

---

## Reference

* Effective Java 3/E(Joshua Bloch 저)
